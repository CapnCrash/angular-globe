!function(){"use strict";function t(){function t(t,a,i){A=t,x=A.raisedLand(),console.log(a[0].clientWidth),d=A.size()||a[0].clientWidth||W,d3.select(window).on("resize",p.bind(null,a)),h=d3.geo.orthographic().translate([d/2,d/2]).precision(.5),u=d3.select(a[0]).append("svg").attr({"class":"m2s-globe",width:d,height:d}),console.log(u.attr("width")),g=d3.geo.path().projection(h),h.scale(d/2.3).clipAngle(90),m=u.append("g").attr("class","m2s-globe-land-group"),f=m.append("path").datum({type:"Sphere"}).attr("class","m2s-globe-water").attr("d",g),y=m.selectAll("path.m2s-globe-land-group").data(d3.geo.graticule().lines()).enter().append("path").attr("class","m2s-globe-graticule"),A.$watch("land",e),A.$watch("points",n,!0),A.$watch("draggable",r),A.$watch("sensitivity",r),A.$watch("clickable",s),A.$watch("rotate",c)}function e(t){t?(x!==!1&&(v=m.append("path").datum(t).attr("class","m2s-globe-land m2s-globe-shadow").style({"-webkit-filter":"blur(6px)",filter:"blur(6px)",opacity:.4}),w=m.append("path").datum(t).attr("class","m2s-globe-land m2s-globe-land-bottom")),k=m.append("path").datum(t).attr("class","m2s-globe-land m2s-globe-land-top"),i()):d3.selectAll(".m2s-globe-land").remove()}function n(t){t=t||[];var e=[];angular.forEach(t,function(t){t.values&&t.values.length&&(e=e.concat(t.values.map(o)))}),b=u.selectAll(".m2s-globe-points").data(e),b.enter().append("path").attr({fill:a(A.pointFill,S),stroke:a(A.pointStroke,$),"stroke-width":a(A.pointStrokeWidth,E),opacity:function(t,e){return l("enter",t,e)>0?0:1}}).attr("class",function(t){return a(A.pointClass)(t)+" m2s-globe-points"}).transition().delay(function(t,e){return l("enter",t,e)||0}).attr("opacity",1),s(A.clickable),b.exit().transition().ease(A.exitEase()||D).delay(function(t,e){return l("exit",t,e)||0}).attr("opacity",0).remove(),i()}function a(t,e){return function(n){return t({d:n.properties})||e}}function i(){h.scale(d/2.3).clipAngle(90),y.attr("d",g),x!==!1&&(v&&v.attr("d",g),h.scale(d/2.2).clipAngle(106.3),w&&w.attr("d",g),h.scale(d/2.2).clipAngle(90)),k&&k.attr("d",g),u.selectAll(".m2s-globe-points").attr("d",function(t){return g.pointRadius(a(A.pointRadius,L)(t))(t)})}function o(t){return{type:"Feature",id:a(A.pointId,"")({properties:t}),properties:t,geometry:{type:"Point",coordinates:[a(A.pointLng)({properties:t}),a(A.pointLat)({properties:t})]}}}function r(){var t=A.draggable(),e=A.sensitivity()||.25;t?m.call(d3.behavior.drag().origin(function(){var t=h.rotate();return{x:t[0]/e,y:-t[1]/e}}).on("drag",function(){var t=h.rotate();h.rotate([d3.event.x*e,-d3.event.y*e,t[2]]),i()})):m.on("dragstart",null).on("drag",null).on("dragend",null)}function l(t,e,n){return A[t+"Delay"]({d:e,i:n})||0}function s(t){t()===!1?(b.style("cursor","normal"),b.on("click",null)):(b.style("cursor","pointer"),b.on("click",function(t){a(A.pointClick)(t)}))}function c(){A.rotate()&&d3.timer(function(){var t=A.rotateSpeed()||1;return h.rotate([t/100*(Date.now()-z),-15]),i(),!A.rotate()})}function p(t){A.size()||(d=t[0].clientWidth||W,u.attr({width:d,height:d}),h.translate([d/2,d/2]).scale(d/2.3).clipAngle(90),f.attr("d",g),i())}var d,u,g,h,b,m,f,y,v,w,k,A,x,S="#8D6E63",$="#000",D="cubic",E=1,L=5,W=400,z=new Date;return{link:t,restrict:"EA",scope:{points:"=",land:"=",size:"&",pointStroke:"&",pointFill:"&",pointClass:"&",pointId:"&",pointLat:"&",pointLng:"&",pointRadius:"&",pointStrokeWidth:"&",draggable:"&",sensitivity:"&",clickable:"&",pointClick:"&",raisedLand:"&",rotate:"&",rotateSpeed:"&",enterDelay:"&",exitDelay:"&",enterEase:"&",exitEase:"&"}}}angular.module("madvas.angular-globe",[]).directive("m2sGlobe",t),t.$inject=[]}();